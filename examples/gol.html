<!-- 
This file shows the most easy use-case for the Cacatoo library. 
It simply load the library and other dependencies using <script>
tags, load some CSS-stylesheets for the GUI, and than starts 
with defining the model. 
-->

<!--  ---------------Do not change the part below ------------------  -->

<html>
<script src="../dist/cacatoo.js"></script>                 <!-- Include cacatoo library (compiled with rollup) -->
<script src="../lib/all.js"></script>                      <!-- Include other libraries (concattenated in 1 file) -->
<link rel="stylesheet" href="../style/cacatoo.css">        <!-- Set style sheet -->
<script>

/*-----------------------Start user-defined code ---------------------*/

let sim;

function setup()
{

    let config = {
            title: "Game of Life",
            description: "Conway's Game of Life",
            maxtime: 1000000,
            fastmode: true,             // If possible, fast-mode will update the model with more than once before displaying the grid
                                        // (note, the actualy FPS may drop below 60 fps when using fast mode)
            ncol : 400,            
            nrow : 170,		            // dimensions of the grid to build
            wrap : [true, true],        // Wrap boundary [COLS, ROWS]   
            scale : 2,				    // scale of the grid (nxn pixels per CA cell)
            statecolours: {'alive':{1:'white'}},    // Only defining the "alive" state, while...
    }

    sim = new Simulation(config)

    sim.makeGridModel("gol");  
        
    sim.initialGrid(sim.gol,'alive',1,0.5)        
    sim.createDisplay("gol","alive")        // Sets up the display to be shown when the model is running
    
    sim.gol.nextState = function(i,j)       // Define the next-state function. This example is game of life
    {   
        // Count living neighbours
        let neighbours = sim.gol.countMoore8(this,i,j,1,'alive')              // In the Moore8 neighbourhood of this CA count # of 1's for the 'alive' property        
        // Get own state
        let state = this.grid[i][j].alive;            
        // Apply the three rules of GoL
        if(state == 0 && neighbours == 3)
        {
            this.grid[i][j].alive = 1;
        }
        else if(state == 1 && (neighbours < 2 || neighbours > 3))
            this.grid[i][j].alive = 0;
        else
            this.grid[i][j].alive = state;
    }
    
    sim.gol.update = function()
    {                                
        this.synchronous()         // Applied as many times as it can in 1/60th of a second
    }

    sim.addPatternButton(sim.gol,'alive')
    sim.addButton("pause/continue",function() { sim.toggle_play()})
    sim.addButton("step",function() { sim.step(); sim.display()})
    sim.start()

}


/*-------------------------End user-defined code ---------------------*/

</script>



<body onload="setup()">        
    <div class="header" id="header"><h2>Cacatoo </h2></div>
    <div class="content" id="canvas_holder"></div>
    <div class="content" id="form_holder"></div>
    <div class="content" id="graph_holder"> </div>
    <div class="footer" id="footer"></div>
</body>

</html>