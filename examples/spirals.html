<html>
<script src="../dist/cacatoo.js"></script>                 <!-- Include cacatoo library (compiled with rollup) -->
<script src="../lib/all.js"></script>                      <!-- Include other libraries (concattenated in 1 file) -->
<link rel="stylesheet" href="../style/cacatoo.css">        <!-- Set style sheet -->

<script>
/*-----------------------Start user-defined code ---------------------*/

let sim;

function setup()
{

    let config = {
            title: "Spirals",
            description: "8 colours with cyclical dominance <br> (stare at your own risk)",
            maxtime: 10000,
            fastmode: true,
            ncol : 200,
            nrow : 200,		                        // dimensions of the grid to build
            wrap : [true, true],                    // Wrap boundary [COLS, ROWS]   
            scale : 2,				                // scale of the grid (nxn pixels per grid cell)
            statecolours: {colour:'default'}        // if set to 'default', createDisplay (below) inherits the default colours of cacatoo
    }

    sim = new Simulation(config)

    sim.makeGridModel("spirals"); 
    sim.createDisplay("spirals","colour")
    let n_species = 8
    
    
    // sim.initialGrid(sim.spirals,'colour',0,2,0.01)        
    for(let i=0;i<sim.spirals.nc;i++)                          // i are columns
        for(let j=0;j<sim.spirals.nr;j++)                      // j are rows
            sim.spirals.grid[i][j]['colour'] = Math.ceil(sim.rng.genrand_real1()*n_species)           

    sim.spirals.nextState = function(i,j)           // Define the next-state function. This example is spirals
    {   
        let state = this.grid[i][j].colour               // Colour of current pixel
        let pred = (this.grid[i][j].colour%n_species)+1  // Colour it is predated by (% because 8 is predated by 1)

        let neighbours = sim.spirals.countMoore8(this,i,j,pred,'colour') // Count the nr of predators
        // Red will spread
        if(sim.rng.genrand_real1() < 0.25*neighbours)   // Let "predator" grow over the current pixel
            this.grid[i][j].colour = pred;
    }    

    sim.spirals.update = function()
    {	
        this.synchronous()                              // Applied as many times as it can in 1/60th of a second
        this.plotPopsizes('colour',[1,2,3,4,5,6,7,8]) 
    }

    sim.addButton("mix grid",function() { sim.spirals.perfectMix()})
    sim.start()
}

/*-------------------------End user-defined code ---------------------*/

</script>



<body onload="setup()">
    <div class="header" id="header"></div>
    <div class="content" id="canvas_holder">  </div>
    <div class="content" id="form_holder">  </div>
    <div class="content" id="graph_holder"> </div>
    <div class="footer" id="footer"></div>
</body>
</html>